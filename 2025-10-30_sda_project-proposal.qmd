---
title: "Project Proposal"
author: "E. Duke Chase"
date: today
---
```{r}
#| label: setup
#| include: false

library(here)
source(here::here("R", "setup.R"))

# Set key directory paths
data_dir <- here::here("data")
output_dir <- here::here("output")

pt_df <- read.csv(here("data", "patient_info.csv"))
cell_df <- read.csv(here("data", "scaled_mibi_data_w_cell_gating.csv"))
```

Provide the the following information for your project.

1. What research question(s) do you hope to answer?

::: {.answer-box}
  Are quantitative measures of the distribution of tumor, immune, and stromal (structural) cells in the tumor microenvironment (TME) useful for predictions of a patient's response to immunotherapy?
:::


2. From where did you obtain the data you will use to answer your research question? Please provide a link I can follow, if possible.

::: {.answer-box}
  Data were obtained from the article *[Processed Multiplexed Ion Beam Imaging (MIBI) of tumor microenvironments of 54 melanoma samples following immunotherapy](https://data.mendeley.com/datasets/79y7bht7tf/2)* on Mendeley Data
:::


3. How many observations does your data set have?

```{r}
#| label: observations

num_pt <- length(unique(cell_df$fov))
min_cells <- range(count(cell_df, fov)[2])[1]
max_cells <- range(count(cell_df, fov)[2])[2]
```



::: {.answer-box}
  - The first dataset contains a small amount of demographic and outcome data on `r num_pt` patients with melanoma who had received immunotherapy for their cancer.
  - The second dataset contains spatial data on cells in a biopsy sampled from each patients melanoma. The number of cells in each sample varies from `r min_cells` to `r max_cells`, for a total of `r nrow(cell_df)` observations.
:::

4. Are you merging multiple data sets?

::: {.answer-box}
  Yes, I'll be using the dataset with cellular information from biopsy samples of the patients to generate spatial summary statistics that will then be incorporated into the dataset which includes patient clinical data.
:::


5. Provide a table listing each variable you are considering for analysis, briefly describe each variable (e.g., the number of disease cases in each region), and the variable type (e.g., numeric, factor, date, etc.).

```{r}
#| label: patient-vars

pt_vars <- tibble(
  "Variable" = c("id", "age_at_dx_tertile", "gross_dx_stage", "response_multi", "response_multi"),
  "Description" = c(
    "Unique identifier for each patient (matches `fov` variable in cell data).",
    "Which tertile of patient ages the patient falls in.",
    "Roman numeral cancer stage at diagnosis",
    "How the patients melanoma responded ot the immunotherapy treatment",
    "A binary version which only indicates whether the disease progressed or not"
  ),
  "Type" = c("Character", "Categorical - Ordinal", "Categorical - Ordinal", "Categorical - Nominal", "Boolean")
)

kbl(pt_vars,
  caption = "Table 1: Patient-level clinical and outcome variables"
) |> 
  kable_styling(bootstrap_options = c("striped", "condensed"), full_width = FALSE)

kbl(cell_vars,
  caption = "Table 2: Cell-level spatial and phenotype variables"
) |> 
  kable_styling(bootstrap_options = c("striped", "condensed"), full_width = FALSE)
```





6. What will your response variable be for answering the research question(s)?

::: {.answer-box}
  I'm planning on doing a multinomial logistic regression model using the treatment response variable, but if time constraints or analytic difficulty become an issue I can fall back on the binary treatment response variable as my outcome.
:::

7. Provide relevant exploratory plots of your data.

```{r}
#| label: demo-plots


```


8. What methods do you plan to use to answer your question of interest?

::: {.answer-box}
I'll use spatial scan statistics to look at first order properties of immune cells and tumor cells to see if relative risk of the most significant clusters for each relate to treatment outcome. I'll also use q-nearest neighbor analysis to look at immune infiltration, which is the degree to which immune cells are distributed in amongst tumor cells.
:::

